<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>micro:bit USB Serial TEST</title>

<style>
body {
    background: #000;
    color: #0f0;
    font-family: monospace;
    padding: 20px;
}
button {
    font-size: 16px;
    padding: 6px 14px;
}
#log {
    margin-top: 20px;
    white-space: pre;
    border: 1px solid #0f0;
    padding: 10px;
    height: 300px;
    overflow-y: auto;
}
</style>
</head>

<body>

<h2>micro:bit USB Serial (NO BLUETOOTH)</h2>

<button id="btn">CONNECT USB</button>
<span id="state">DISCONNECTED</span>

<div id="log"></div>

<script>
/* ===============================
   HARD FAIL IF NO WEB SERIAL
================================ */
if (!("serial" in navigator)) {
    alert("Web Serial NOT supported. Use Chrome or Edge.");
    throw new Error("NO WEB SERIAL");
}

const btn   = document.getElementById("btn");
const log   = document.getElementById("log");
const state = document.getElementById("state");

btn.onclick = async () => {
    try {
        const port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });

        state.textContent = "CONNECTED (USB)";
        log.textContent += "USB CONNECTED\n";

        const decoder = new TextDecoderStream();
        port.readable.pipeTo(decoder.writable);
        const reader = decoder.readable.getReader();

        while (true) {
            const { value } = await reader.read();
            if (value) {
                log.textContent += value;
                log.scrollTop = log.scrollHeight;
            }
        }
    } catch (e) {
        log.textContent += "ERROR: " + e + "\n";
    }
};
</script>

</body>
</html>
