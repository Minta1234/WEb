<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<title>XO Tournament</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#050505;
  --panel:#0d0d0d;
  --neon:#00ffcc;
  --danger:#ff0044;
  --warn:#ffaa00;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:system-ui,Arial,monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:20px;
}
#app{
  width:100%;
  max-width:400px;
  background:var(--panel);
  padding:clamp(16px, 4vw, 24px);
  border-radius:12px;
  box-shadow:0 8px 32px rgba(0,255,204,0.2);
}
h1{
  margin:0 0 16px;
  color:var(--neon);
  text-align:center;
  font-size:clamp(1.5rem, 5vw, 2rem);
  text-shadow:0 0 10px var(--neon);
}
input,select,button{
  width:100%;
  margin:8px 0;
  padding:12px;
  font-size:clamp(14px, 3vw, 16px);
  border-radius:8px;
  border:2px solid #222;
  background:#111;
  color:#fff;
  transition:all 0.3s;
}
input:focus,select:focus{
  outline:none;
  border-color:var(--neon);
  box-shadow:0 0 10px rgba(0,255,204,0.3);
}
button{
  cursor:pointer;
  background:var(--neon);
  color:#000;
  font-weight:bold;
  border:none;
}
button:hover{
  background:#00ddaa;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,255,204,0.4);
}
button:active{
  transform:translateY(0);
}
#board{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:clamp(6px, 2vw, 10px);
  margin:16px 0;
}
.cell{
  aspect-ratio:1;
  min-height:80px;
  font-size:clamp(40px, 10vw, 56px);
  background:#111;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:8px;
  user-select:none;
  transition:all 0.2s;
  font-weight:bold;
  border:2px solid #222;
}
.cell.active{
  cursor:pointer;
  border-color:#333;
}
.cell.active:hover{
  background:#1a1a1a;
  border-color:var(--neon);
  transform:scale(1.05);
}
.cell.disabled{
  pointer-events:none;
  opacity:.6;
}
.cell:has(.x-mark){
  color:var(--neon);
  text-shadow:0 0 10px var(--neon);
}
.cell:has(.o-mark){
  color:var(--danger);
  text-shadow:0 0 10px var(--danger);
}
.win{
  animation:flash .4s ease-in-out infinite alternate;
}
@keyframes flash{
  from{
    background:var(--neon);
    transform:scale(1.1);
    box-shadow:0 0 20px var(--neon);
  }
  to{
    background:var(--danger);
    transform:scale(1.15);
    box-shadow:0 0 20px var(--danger);
  }
}
#msg{
  min-height:48px;
  font-size:clamp(20px, 5vw, 28px);
  text-align:center;
  margin:12px 0;
  color:var(--neon);
  font-weight:bold;
  text-shadow:0 0 8px var(--neon);
}
#timer{
  text-align:center;
  font-size:clamp(16px, 4vw, 20px);
  color:var(--warn);
  font-weight:bold;
  min-height:28px;
}
.hidden{display:none!important}
#levelContainer{
  display:none;
}
#levelContainer.show{
  display:block;
}
@media (max-width: 480px) {
  #app{
    padding:12px;
  }
  .cell{
    min-height:70px;
  }
}
</style>
</head>
<body><img src="/Image/ribbon_top_right.png" 
     alt="Black mourning ribbon for websites, top right corner, ‡∏£‡∏¥‡∏ö‡∏ö‡∏¥‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡∏™‡∏µ‡∏î‡∏≥ ‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≤‡∏•‡∏±‡∏¢‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå" 
     style="position:fixed; top:0; right:0; width:80px; opacity:0.9; z-index:9999; pointer-events:none;">
  
<div id="app">

<h1>‚≠ï XO Tournament ‚ùå</h1>

<div id="setup">
  <input id="p1" placeholder="Player 1 Name" value="Player 1" maxlength="20">
  <input id="p2" placeholder="Player 2 Name" value="Player 2" maxlength="20">
  <select id="mode">
    <option value="pvp">üë• 2 Players (1 Device)</option>
    <option value="ai">ü§ñ VS AI</option>
  </select>
  <div id="levelContainer">
    <select id="level">
      <option value="easy">üòä AI Easy</option>
      <option value="hard">üòé AI Hard</option>
      <option value="extreme">üòà AI Extreme (Unbeatable)</option>
    </select>
  </div>
  <button id="start">START GAME</button>
</div>

<div id="msg"></div>
<div id="timer"></div>

<div id="board" class="hidden"></div>

<button id="reset" class="hidden">NEW GAME</button>

</div>

<script>
/* ======================
   CORE STATE
====================== */
const boardEl = document.getElementById("board");
const msgEl   = document.getElementById("msg");
const timerEl = document.getElementById("timer");
const resetBtn= document.getElementById("reset");
const setupEl = document.getElementById("setup");
const modeSelect = document.getElementById("mode");
const levelContainer = document.getElementById("levelContainer");

let board = [];
let turn = 0;            // 0 = X, 1 = O
let names = [];
let mode = "pvp";
let aiLevel = "easy";
let gameActive = false;

let timer = 0;
let timerInt = null;

const TURN_TIME = 10;

const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

/* ======================
   INIT / START
====================== */
document.getElementById("start").onclick = startGame;
resetBtn.onclick = ()=>{
  setupEl.classList.remove("hidden");
  resetBtn.classList.add("hidden");
  boardEl.classList.add("hidden");
  msgEl.textContent = "";
  timerEl.textContent = "";
  gameActive = false;
  clearInterval(timerInt);
};

// Show/hide AI level selector based on mode
modeSelect.onchange = ()=>{
  if(modeSelect.value === "ai"){
    levelContainer.classList.add("show");
    document.getElementById("p2").value = "AI";
  } else {
    levelContainer.classList.remove("show");
    document.getElementById("p2").value = "Player 2";
  }
};

function startGame(){
  const p1Input = document.getElementById("p1").value.trim();
  const p2Input = document.getElementById("p2").value.trim();
  
  names = [
    p1Input || "Player 1",
    mode === "ai" ? "AI" : (p2Input || "Player 2")
  ];
  
  mode = modeSelect.value;
  aiLevel = document.getElementById("level").value;

  setupEl.classList.add("hidden");
  boardEl.classList.remove("hidden");
  resetBtn.classList.remove("hidden");

  board = Array(9).fill("");
  turn = 0;
  gameActive = true;

  drawBoard();
  nextTurn();
}

/* ======================
   UI
====================== */
function drawBoard(){
  boardEl.innerHTML = "";
  board.forEach((v,i)=>{
    const c = document.createElement("div");
    c.className = "cell";
    if(gameActive && !v) c.classList.add("active");
    if(v) c.classList.add("disabled");
    
    if(v === "X"){
      const span = document.createElement("span");
      span.className = "x-mark";
      span.textContent = "‚ùå";
      c.appendChild(span);
    } else if(v === "O"){
      const span = document.createElement("span");
      span.className = "o-mark";
      span.textContent = "‚≠ï";
      c.appendChild(span);
    }
    
    c.onclick = ()=>handleMove(i);
    boardEl.appendChild(c);
  });
}

function lockBoard(){
  [...boardEl.children].forEach(c=>{
    c.classList.remove("active");
    c.classList.add("disabled");
  });
}

/* ======================
   GAME FLOW
====================== */
function handleMove(i){
  if(!gameActive) return;
  if(board[i]) return;

  board[i] = turn ? "O" : "X";
  drawBoard();

  if(checkEnd()) return;

  turn ^= 1;
  nextTurn();
}

function nextTurn(){
  clearInterval(timerInt);
  const symbol = turn ? "‚≠ï" : "‚ùå";
  msgEl.textContent = `${names[turn]}'s Turn ${symbol}`;
  startTimer();

  if(mode==="ai" && turn===1){
    lockBoard();
    setTimeout(aiMove, 600);
  }
}

function startTimer(){
  timer = TURN_TIME;
  timerEl.textContent = `‚è± Time: ${timer}s`;
  timerInt = setInterval(()=>{
    timer--;
    timerEl.textContent = `‚è± Time: ${timer}s`;
    if(timer <= 3 && timer > 0){
      timerEl.style.color = "var(--danger)";
      timerEl.style.animation = "flash 0.5s infinite";
    }
    if(timer<=0){
      clearInterval(timerInt);
      timerEl.textContent = "‚è± Time's Up!";
      timerEl.style.animation = "";
      setTimeout(()=>{
        turn ^= 1;
        nextTurn();
        timerEl.style.color = "var(--warn)";
      }, 1000);
    }
  },1000);
}

/* ======================
   END CHECK
====================== */
function checkEnd(){
  const w = getWinner(board);
  if(w){
    endGame(`üéâ ${names[turn]} WINS! üéâ`, w);
    return true;
  }
  if(board.every(v=>v)){
    endGame("ü§ù DRAW! ü§ù");
    return true;
  }
  return false;
}

function endGame(text, winLine){
  gameActive = false;
  clearInterval(timerInt);
  msgEl.textContent = text;
  timerEl.textContent = "";
  lockBoard();
  if(winLine){
    winLine.forEach(i=>{
      boardEl.children[i].classList.add("win");
    });
  }
}

/* ======================
   AI
====================== */
function aiMove(){
  if(!gameActive) return;
  let move;
  if(aiLevel==="easy") move = randomMove(board);
  else if(aiLevel==="hard") move = smartMove(board);
  else move = minimax(board, true).i;

  if(move !== undefined && move !== null){
    handleMove(move);
  }
}

function randomMove(b){
  const e = b.map((v,i)=>v?null:i).filter(v=>v!==null);
  return e.length > 0 ? e[Math.floor(Math.random()*e.length)] : null;
}

function smartMove(b){
  // Try to win first
  for(let i=0;i<9;i++){
    if(!b[i]){
      b[i]="O";
      if(getWinner(b)){
        b[i]="";
        return i;
      }
      b[i]="";
    }
  }
  // Block opponent
  for(let i=0;i<9;i++){
    if(!b[i]){
      b[i]="X";
      if(getWinner(b)){
        b[i]="";
        return i;
      }
      b[i]="";
    }
  }
  // Take center if available
  if(!b[4]) return 4;
  
  return randomMove(b);
}

function minimax(b,max){
  const w = getWinner(b);
  if(w==="O") return {s:1};
  if(w==="X") return {s:-1};
  if(b.every(v=>v)) return {s:0};

  let best = {s: max?-99:99, i:null};
  b.forEach((v,i)=>{
    if(!v){
      b[i] = max?"O":"X";
      const r = minimax(b,!max);
      b[i] = "";
      r.i = i;
      if(max ? r.s>best.s : r.s<best.s) best = r;
    }
  });
  return best;
}

/* ======================
   UTILS
====================== */
function getWinner(b){
  for(const w of wins){
    if(w.every(i=>b[i] && b[i]===b[w[0]])) return b[w[0]];
  }
  return null;
}
</script>
</body>
</html>
