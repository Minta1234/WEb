<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess Tournament</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{
  margin:0;background:#050505;color:#fff;
  font-family:Arial;display:flex;
  justify-content:center;align-items:center;height:100vh
}
#app{width:380px;text-align:center}
h1{color:#00ffcc;margin:6px 0}
#msg{font-size:26px;height:36px;margin:8px 0;color:#ff4444}
#timer{display:flex;justify-content:space-between;font-size:18px}
#board{
  display:grid;grid-template-columns:repeat(8,1fr);
  border:3px solid #00ffcc;margin-top:6px
}
.cell{
  width:46px;height:46px;
  display:flex;align-items:center;justify-content:center;
  font-size:28px;user-select:none
}
.dark{background:#222}
.light{background:#aaa;color:#000}
.select{outline:3px solid red}
button{
  width:100%;padding:10px;
  margin-top:8px;font-size:16px
}
select{width:100%;padding:8px;margin-top:6px}
</style>
</head>
<body>

<div id="app">
<h1>Chess Tournament</h1>

<select id="mode">
  <option value="pvp">2 Player (Offline)</option>
  <option value="ai-easy">VS AI – Easy</option>
  <option value="ai-hard">VS AI – Hard</option>
</select>

<div id="timer">
  <div>WHITE ⏱ <span id="tw">300</span></div>
  <div>BLACK ⏱ <span id="tb">300</span></div>
</div>

<div id="msg"></div>
<div id="board"></div>
<button onclick="reset()">RESET</button>
</div>

<script>
const boardEl=document.getElementById("board");
const msgEl=document.getElementById("msg");
const twEl=document.getElementById("tw");
const tbEl=document.getElementById("tb");
const modeSel=document.getElementById("mode");

const P={r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟",
         R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔",P:"♙"};

let board,turn,sel,lock=false;
let tw=300,tb=300,clock;

function init(){
  board=[
   "rnbqkbnr","pppppppp","........","........",
   "........","........","PPPPPPPP","RNBQKBNR"
  ].map(r=>r.split(""));
  turn="w";sel=null;lock=false;
  tw=tb=300;
  msg("WHITE TURN");
  draw(); startClock();
}
function msg(t){msgEl.textContent=t}

function startClock(){
  clearInterval(clock);
  clock=setInterval(()=>{
    if(lock) return;
    if(turn==="w"){tw--;twEl.textContent=tw}
    else{tb--;tbEl.textContent=tb}
    if(tw<=0||tb<=0){
      lock=true;
      msg("⏱ TIME OUT");
    }
  },1000);
}

function draw(){
  boardEl.innerHTML="";
  for(let y=0;y<8;y++)for(let x=0;x<8;x++){
    const c=document.createElement("div");
    c.className="cell "+((x+y)%2?"dark":"light");
    c.textContent=P[board[y][x]]||"";
    if(sel&&sel.x===x&&sel.y===y)c.classList.add("select");
    c.onclick=()=>click(x,y);
    boardEl.appendChild(c);
  }
}

function click(x,y){
  if(lock) return;
  if(sel){
    if(move(sel.x,sel.y,x,y)){
      if(checkmate(turn==="w"?"b":"w")){
        lock=true;
        msg("♚ CHECKMATE");
        return;
      }
      turn=turn==="w"?"b":"w";
      msg(turn==="w"?"WHITE TURN":"BLACK TURN");
      sel=null;
      if(aiTurn()) setTimeout(aiMove,300);
    }else sel=null;
  }else{
    const p=board[y][x];
    if(p!="."&&((turn==="w"&&p===p.toUpperCase())||(turn==="b"&&p===p.toLowerCase())))
      sel={x,y};
  }
  draw();
}

function move(x1,y1,x2,y2){
  const p=board[y1][x1];
  if(board[y2][x2]!="." &&
     ((p===p.toUpperCase())==(board[y2][x2]===board[y2][x2].toUpperCase())))
     return false;

  if(!valid(p,x1,y1,x2,y2)) return false;
  board[y2][x2]=p;board[y1][x1]=".";
  return true;
}

function valid(p,x1,y1,x2,y2){
  const dx=x2-x1,dy=y2-y1;
  const adx=Math.abs(dx),ady=Math.abs(dy);
  switch(p.toLowerCase()){
    case"p":{
      const d=p===p.toUpperCase()?-1:1;
      if(dx===0&&dy===d&&board[y2][x2]==".")return true;
      if(adx===1&&dy===d&&board[y2][x2]!=".")return true;
      return false;}
    case"r": if(dx&&dy||blocked(x1,y1,x2,y2))return false; break;
    case"b": if(adx!==ady||blocked(x1,y1,x2,y2))return false; break;
    case"q": if((dx&&dy&&adx!==ady)||blocked(x1,y1,x2,y2))return false; break;
    case"n": if(!((adx===1&&ady===2)||(adx===2&&ady===1)))return false; break;
    case"k": if(adx>1||ady>1)return false;
  }
  return true;
}

function blocked(x1,y1,x2,y2){
  const sx=Math.sign(x2-x1),sy=Math.sign(y2-y1);
  x1+=sx;y1+=sy;
  while(x1!=x2||y1!=y2){
    if(board[y1][x1]!=".")return true;
    x1+=sx;y1+=sy;
  }
  return false;
}

/* ===== CHECK / CHECKMATE ===== */
function kingPos(color){
  for(let y=0;y<8;y++)for(let x=0;x<8;x++){
    const p=board[y][x];
    if((color==="w"&&p==="K")||(color==="b"&&p==="k"))return{x,y};
  }
}
function inCheck(color){
  const k=kingPos(color);
  for(let y=0;y<8;y++)for(let x=0;x<8;x++){
    const p=board[y][x];
    if(p!="."&&((color==="w")!=(p===p.toUpperCase()))){
      if(valid(p,x,y,k.x,k.y)) return true;
    }
  }
  return false;
}
function checkmate(color){
  if(!inCheck(color))return false;
  return true; // simplified tournament logic
}

/* ===== AI ===== */
function aiTurn(){
  return modeSel.value.startsWith("ai")&&turn==="b";
}
function aiMove(){
  if(lock) return;
  let moves=[];
  for(let y=0;y<8;y++)for(let x=0;x<8;x++){
    if(board[y][x]==board[y][x].toLowerCase()){
      for(let yy=0;yy<8;yy++)for(let xx=0;xx<8;xx++){
        if(valid(board[y][x],x,y,xx,yy))
          moves.push({x,y,xx,yy});
      }
    }
  }
  const m=moves[Math.floor(Math.random()*moves.length)];
  move(m.x,m.y,m.xx,m.yy);
  turn="w";msg("WHITE TURN");
  draw();
}

function reset(){init()}
init();
</script>
</body>
</html>

