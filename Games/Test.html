<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mobile Sensor Graph Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: system-ui, Arial, sans-serif;
    background: #020617;
    color: #e5e7eb;
}

header {
    padding: 12px;
    background: #020617;
    border-bottom: 1px solid #1e293b;
    text-align: center;
    font-weight: 600;
}

.container {
    padding: 12px;
    display: grid;
    gap: 12px;
}

.card {
    background: #020617;
    border: 1px solid #1e293b;
    border-radius: 8px;
    padding: 12px;
}

h3 {
    margin: 0 0 8px 0;
    font-size: 14px;
    color: #38bdf8;
}

video {
    width: 100%;
    border-radius: 6px;
    background: black;
}

.data {
    font-size: 13px;
    line-height: 1.6;
}

canvas {
    width: 100%;
    height: 160px;
    background: #020617;
    border: 1px solid #1e293b;
    border-radius: 6px;
}

button {
    padding: 10px;
    border: none;
    background: #2563eb;
    color: white;
    border-radius: 6px;
    font-weight: 600;
}

.footer {
    text-align: center;
    font-size: 11px;
    opacity: 0.6;
}
</style>
</head>

<body>

<header>Mobile Sensor Graph Monitor</header>

<div class="container">

<div class="card">
    <h3>Camera</h3>
    <video id="camera" autoplay playsinline></video>
</div>

<div class="card">
    <h3>Accelerometer Graph (X,Y,Z)</h3>
    <canvas id="accelGraph" width="600" height="160"></canvas>
</div>

<div class="card">
    <h3>Orientation Graph (Beta)</h3>
    <canvas id="orientGraph" width="600" height="160"></canvas>
</div>

<div class="card">
    <button onclick="enableAll()">Enable Sensors</button>
</div>

</div>

<div class="footer">HTTPS required â€¢ Real-time sensor plotting</div>

<script>
/* ================= CAMERA ================= */
async function startCamera() {
    const video = document.getElementById("camera");
    const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { ideal: "environment" } },
        audio: false
    });
    video.srcObject = stream;
}

/* ================= PERMISSIONS ================= */
async function enableAll() {
    if (typeof DeviceMotionEvent?.requestPermission === "function") {
        await DeviceMotionEvent.requestPermission();
        await DeviceOrientationEvent.requestPermission();
    }
    startCamera();
}

/* ================= GRAPH ENGINE ================= */
function createGraph(canvasId, maxPoints = 100) {
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext("2d");
    let data = [];

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "#1e293b";
        ctx.beginPath();
        ctx.moveTo(0, canvas.height / 2);
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();

        data.forEach((line, index) => {
            ctx.strokeStyle = ["#38bdf8", "#22c55e", "#f97316"][index] || "#e5e7eb";
            ctx.beginPath();
            line.forEach((v, i) => {
                const x = (i / maxPoints) * canvas.width;
                const y = canvas.height / 2 - v * 4;
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.stroke();
        });
    }

    function push(values) {
        values.forEach((v, i) => {
            if (!data[i]) data[i] = [];
            data[i].push(v);
            if (data[i].length > maxPoints) data[i].shift();
        });
        draw();
    }

    return { push };
}

const accelGraph = createGraph("accelGraph");
const orientGraph = createGraph("orientGraph");

/* ================= MOTION ================= */
window.addEventListener("devicemotion", e => {
    const a = e.accelerationIncludingGravity;
    if (!a) return;
    accelGraph.push([
        a.x || 0,
        a.y || 0,
        a.z || 0
    ]);
});

/* ================= ORIENTATION ================= */
window.addEventListener("deviceorientation", e => {
    if (e.beta === null) return;
    orientGraph.push([e.beta]);
});
</script>

</body>
</html>
