<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Control Fruit Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
#game{
  position:relative;
  width:800px;
  height:500px;
  background:#222;
  overflow:hidden;
}
video,canvas{
  position:absolute;
  width:100%;
  height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}
#hud{
  position:absolute;
  top:10px;
  left:10px;
  color:#0f0;
  font-size:20px;
  z-index:10;
}
</style>
</head>

<body>
<div id="game">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <div id="hud">Score: <span id="score">0</span></div>
</div>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');

canvas.width = 800;
canvas.height = 500;

let basketX = 350;
const basketWidth = 100;
let score = 0;

let fruits = [];

/* ===== Basket ===== */
function drawBasket(){
  ctx.fillStyle = '#ffaa00';
  ctx.fillRect(basketX, canvas.height-40, basketWidth, 20);
}

/* ===== Fruits ===== */
function spawnFruit(){
  fruits.push({
    x: Math.random()*760,
    y: -20,
    r: 10
  });
}

setInterval(spawnFruit, 1000);

function drawFruits(){
  ctx.fillStyle='red';
  fruits.forEach(f=>{
    ctx.beginPath();
    ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
    ctx.fill();
    f.y += 3;

    // collision
    if(
      f.y > canvas.height-50 &&
      f.x > basketX &&
      f.x < basketX + basketWidth
    ){
      score++;
      scoreEl.textContent = score;
      f.y = 1000;
    }
  });

  fruits = fruits.filter(f=>f.y < canvas.height+50);
}

/* ===== MediaPipe Hands ===== */
const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results=>{
  if(results.multiHandLandmarks){
    const hand = results.multiHandLandmarks[0];
    const wristX = hand[0].x; // 0 = wrist

    // แปลงตำแหน่งมือ → ตะกร้า
    basketX = wristX * canvas.width - basketWidth/2;

    // clamp
    basketX = Math.max(0, Math.min(basketX, canvas.width-basketWidth));
  }
});

/* ===== Camera ===== */
const camera = new Camera(video,{
  onFrame: async ()=>{
    await hands.send({image: video});
  },
  width:800,
  height:500
});
camera.start();

/* ===== Game Loop ===== */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBasket();
  drawFruits();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
